# ExcelTemplate

## 简介

本项目是一个基于 NPOI 的 Excel 模版引擎，旨在解决工作中遇到的 Excel 模版导入导出问题。本模版引擎可以方便地将 Excel 映射到对应的 .Net 类实体，也可以将类实体数据渲染成对应的 Excel 文件。

可是，模版引擎不是有很多成熟的方案了吗？为什么要重复发明轮子？

之所以决定动手再造一遍轮子，是因为觉得已有的那些方案还是有些欠缺，无法满足我的实际需要。为了解决在实际应用场景的某些痛点，本模版引擎将着重解决以下几个问题：

- 表单和列表混排
- 导入和导出双向模版
- 错误信息管理（重点）

### 1.表单和列表混排

什么是表单？什么是列表？

这是表单 ↓↓，每个数据基本上对应固定的单元格：

![](docs/images/image.png)

这是列表 ↓↓，映射的是一个集合，只有确定的列，没有固定的行：

![](docs/images/image-1.png)

这是混排 ↓↓，两种需要完全不同处理逻辑的东西混杂在一起：

![](docs/images/image-2.png)

单纯的表单或列表，处理起来还是比较简单的。而当两者混排起来的话，就会变得稍微复杂一点。因为对于列表来说，通常情况下数据量是变化的，也就是说，在 Excel 表格里的实际占用的纵向高度是随着实际情况变化的，排在表格底下的其他数据，必然要被挤到更下面的空间，这使得模版设计时所指定的坐标，无论是表单还是列表，都不是固定不变的，这就要求必须拥有一定的自适应能力。

### 2.导入和导出双向模版

同一个模版，能同时支持导入和导出，特别是能在混排的情况下拥有双向能力。

### 3.错误信息管理（重点）

这是一个非常重要且有用的功能，也是我决定自己动手造轮子的一个重要推动力。
对于导入功能，我们经常需要对数据进行校验，而校验失败的数据，需要以错误的形式提示给用户。
这时会有以下需求：

1. 输出错误信息的时，需要把错误信息定位到具体的 Excel 单元格坐标，即使是混排的复杂布局下
2. 以一种 **简单** 且 **直观** 的方式进行错误信息的录入

可是我们使用模版引擎已经把 Excel 映射到类实体了，导致了进行错误处理时，我们直接面对的是类实体，而不是 Excel 的单元格，当需要从实体的每个字段反向计算所映射到的 Excel 中的实际位置时，别是混排的情况下，将是一个十分麻烦的过程，反正肯定算不上 “**简单**” 和 “**直观**”。
当我们享受实体映射带来的自动挡般的优雅时，计算 Excel 单元格坐标的操作，又再一次把我们拉回到手动挡时代。所以，我希望能解决这个问题。

## 开发进度
### 已完成

- 从类型（Type）生成模版定义
- 根据模版从 Excel 读取数据生成类实体
- 根据模版从类实体渲染为 Excel
- 单元格错误提示管理功能
- 简单的样式支持

### 待完成

- 从 Excel 生成模版定义
